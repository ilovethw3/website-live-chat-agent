# Epic 003: 召回编排层

**创建时间**: 2025-10-18  
**负责角色**: PM (Product Manager AI)  
**状态**: 规划中  
**优先级**: P0  

---

## 业务背景

### 问题陈述
- 当前智能客服的知识召回仅依赖单一向量检索，缺乏对关键词、FAQ、业务 API 等多源信息的统筹，导致命中率受限。
- 运营无法在不改代码的情况下调节召回策略、权重或临时下线某路召回，线上风险无法快速控制。
- 没有可观测的召回指标和实验能力，新增策略难以验证效果，导致知识库运营成本高。

### 解决方案
- 建立统一的召回编排层服务，负责聚合多种召回来源、统一排序与去重，并输出标准结果给生成层。
- 提供策略配置与灰度发布能力，让运营可自助开启/调整召回源，PM 能运行 A/B 实验评估收益。
- 输出召回日志与指标，支持实时监控、异常告警和效果看板，形成闭环的运营治理能力。

### 目标用户
- 客服运营人员：需要快速配置召回策略、处理热点内容。
- 产品与增长团队：需要验证新召回方案对命中率和满意度的影响。
- 技术支持团队：需要监控召回链路稳定性、及时降级。

---

## 业务价值
- 提升知识命中率与自动解决率，减少人工介入成本。
- 缩短召回策略从提出到上线的周期，实现分钟级配置变更。
- 为后续的模型迭代、FAQ 运营提供可量化的实验平台。

---

## 核心功能需求

### 用户故事 1: 多源召回编排
**作为** 客服运营人员  
**我希望** 可以并行使用向量、关键词、FAQ、业务 API 等召回来源，并能配置权重与阈值  
**以便于** 根据业务场景快速提升命中率或临时下线风险召回源

**验收标准**:
1. 运营可在配置中心开启/关闭某个召回源，并设置权重与超时时间。
2. 召回结果按配置权重排序并输出给下游，对重复内容自动去重。
3. 当某召回源超时或异常时，系统自动降级且记录日志、发出告警。

**场景示例**:
```
运营人员在配置中心将“关键词召回”权重提升至 0.4，并设置 300ms 超时。
用户提出“退款政策”，系统同时调用向量与关键词召回，最终按权重融合返回 FAQ。
关键词召回在 200ms 内响应；若超时，系统只使用向量结果并在看板中记录一次超时事件。
```

### 用户故事 2: 召回策略实验
**作为** 产品经理  
**我希望** 通过 A/B 实验对比不同召回策略的表现  
**以便于** 量化新策略是否提升客户满意度或命中率

**验收标准**:
1. 可以为召回策略创建实验，定义实验组和对照组的配置差异及流量分配。
2. 实验期间自动采集召回命中率、人工转接率等指标，并提供实验看板。
3. 实验结束可一键回到对照组配置，并自动生成简要结果报告。

**场景示例**:
```
PM 创建“FAQ 优先策略”实验，50% 流量使用高 FAQ 权重，50% 保持现状。
实验运行一周自动统计召回命中率差异，若提升未达 5%，建议回滚。
PM 在看板查看结果并点击“结束实验”，系统恢复原配置。
```

### 用户故事 3: 召回链路监控与告警
**作为** 技术支持团队成员  
**我希望** 能实时监控召回链路的成功率、耗时和异常  
**以便于** 快速定位问题并采取降级措施

**验收标准**:
1. 提供召回链路监控指标，包括整体成功率、各召回源耗时、超时次数。
2. 当关键指标低于阈值时自动告警，并显示最近一次召回日志详情。
3. 支持一键触发降级策略（例如仅保留关键词召回），并记录操作日志。

**场景示例**:
```
系统检测到向量召回 5 分钟内成功率低于 80%，自动向技术支持发送告警。
工程师在控制台查看超时日志，临时关闭向量召回并启用 FAQ 兜底。
问题解决后恢复原有策略，系统将事件记录入变更日志。
```

---

## Epic级别验收标准

### 功能验收
- 聚合至少三类召回源（向量、关键词、FAQ）并支持配置开关、权重、超时。
- 召回结果具备合并去重、降级兜底能力，输出统一标准结果给生成层。
- 提供 A/B 实验与配置管理入口，支持实验的创建、执行、结束。

### 质量验收
- 召回编排层 P99 延迟 ≤ 800ms，成功率 ≥ 99%。
- 对单一召回源故障具备自动降级能力，相关告警在 1 分钟内触达。
- 有完整的日志与监控指标，可以追溯每次召回的来源与排序过程。

### 业务价值验收
- 新策略上线后，知识命中率较基线提升 ≥ 15%（按实验结果或灰度数据评估）。
- 运营配置召回策略的平均上线时间 ≤ 30 分钟，无需开发参与。
- 转人工率或人工平均处理时长较基线下降 ≥ 10%。

---

## 时间规划
- Sprint 1：需求梳理、召回源梳理、配置模型设计。
- Sprint 2：实现召回编排服务（聚合、排序、去重、降级）及基础监控。
- Sprint 3：接入配置中心、A/B 实验框架、上线监控看板与告警。

---

## 成功指标
- 召回命中率（命中匹配的会话占比）。
- 自动解决率（无需转人工的会话比例）。
- 召回策略调整耗时（从提出到上线的时长）。
- 实验覆盖率（纳入实验的召回策略占比）。
- 召回链路告警响应时间（告警到处理的平均时长）。

